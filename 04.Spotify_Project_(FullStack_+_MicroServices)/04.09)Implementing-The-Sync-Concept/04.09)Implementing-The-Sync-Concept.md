```markdown
### ▶ Practical / Code Implementation (Concept from 04.08)
➡️ this is the real implementation of the previously discussed concept
```

```markdown
### ▶ Socket Setup — Backend (Music Service)
➡️ go to `music-service`
➡️ npm i socket.io cookie
➡️ create `src/socket/socket.server.js`
```

```markdown
### ▶ Socket Server File
➡️ import `Server` from `socket.io`
   // Server → creates a Socket.IO server on top of HTTP

➡️ import `cookie` from `cookie`
   // cookie → parses raw cookie headers into JS objects

➡️ import `config` and `jwt`
   // config → access JWT secret
   // jwt → verify and decode authentication tokens
```

```markdown
### ▶ initSocketServer Function
➡️ create function `initSocketServer(httpServer)`

➡️ inside the function:

➡️ set `io` using:
   - new Server(httpServer, { cors })
   // attaches socket server to existing HTTP server
   // CORS needed for frontend connection

➡️ use `io.use((socket, next) => { ... })`
   // middleware that runs before socket connection is accepted

➡️ inside middleware:
   - parse cookies using:
     `cookie.parse(socket.handshake.headers.cookie || '')`
     // handshake.headers.cookie contains raw cookie string
     // fallback avoids crash if no cookies exist

   - extract token from `cookies.token`
   - if token missing → send authentication error

   - in try block:
     → verify token using `jwt.verify(token, config.JWT_SECRET)`
     → set `socket.user = decoded`
     → call `next()` to allow connection
```

```markdown
### ▶ Socket Connection Events
➡️ use `io.on('connection', socket => { ... })`

➡️ inside connection:
   - `socket.join(socket.user.id)`
     // creates a private room per user (userId as room name)

➡️ listen for:
   `socket.on('play', data => { ... })`

➡️ inside play event:
   - extract `musicId` from data
   - broadcast to same user room:
     `socket.broadcast.to(socket.user.id).emit('play', musicId)`
     // syncs play action across user sessions

➡️ handle disconnect:
   - `socket.on('disconnect', () => socket.leave(socket.user.id))`
```

```markdown
### ▶ Export Socket Initializer
➡️ export `initSocketServer`
```

```markdown
### ▶ Server Integration (Music Server)
➡️ go to `server.js`
➡️ import `initSocketServer`
➡️ import `http`
   // http → required to create raw HTTP server for socket.io

➡️ create server:
   `const httpServer = http.createServer(app)`
   // app is Express instance

➡️ after `connectDB()`:
   - call `initSocketServer(httpServer)`

➡️ listen using:
   - `httpServer.listen(PORT)`
   // socket.io must listen on HTTP server, not app.listen
```

```markdown
### ▶ Frontend Socket Setup
➡️ in frontend
➡️ npm i socket.io-client
```

```markdown
### ▶ App.jsx — Socket Initialization
➡️ import `{ io }` from `socket.io-client`
   // io → creates client-side socket connection

➡️ import `useState`, `useEffect`
   // React hooks for state and lifecycle

➡️ create `socket` state using `useState(null)`
```

```markdown
### ▶ useEffect for Socket Connection
➡️ use `useEffect(() => { ... }, [])`
   // empty dependency array → runs once on mount

➡️ inside:
   - create `newSocket` using:
     `io(MUSIC_SERVICE_URL, { withCredentials: true })`
     // credentials required for cookies (JWT)

➡️ set socket state:
   - `setSocket(newSocket)`

➡️ add listener:
   - `newSocket.on('play', data => { ... })`

➡️ inside listener:
   - extract `musicId` from data
   - redirect:
     `window.location.href = /music/${musicId}`
   // sync navigation when play event occurs
```

```markdown
### ▶ Pass Socket to Home Route
➡️ in `App.jsx` routes
➡️ on home route:
   - pass `socket={socket}` as prop
```

```markdown
### ▶ Home.jsx — Emit Play Event
➡️ receive socket as:
   `{ socket }`

➡️ on music card play button:
   - inside same `onClick` as navigation
   - emit:
     `socket?.emit("play", { musicId: m.id })`
   // optional chaining avoids crash if socket not ready
```

```markdown
### ▶ MusicPlayer Component
➡️ in `MusicPlayer.jsx`

➡️ create:
   - `isPlaying` state, default `true`

➡️ add to `<audio>`:
   - `autoPlay={true}`
   // ensures music starts immediately
   // fixes sync issue when multiple players load
```
