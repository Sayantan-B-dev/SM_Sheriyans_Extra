```markdown
### ▶ Continuation — Music Server (Playlist & Public Access)
➡️ continuing from the point where music upload, `music.controller` and storage service are completed
```

```markdown
### ▶ Playlist Model
➡️ create `playlist.model.js`
➡️ import `mongoose` // ODM used to model MongoDB data

➡️ create `playlistSchema` with fields:
   - `title`
   - `artistId`
   - `artist`
   - `musics`: array of objects
       → type: `mongoose.Schema.Types.ObjectId`
       → ref: `'music'` // links playlist items to music collection

➡️ create the model
➡️ export the model
```

```markdown
### ▶ Create Playlist Controller
➡️ go to `music.controller.js`
➡️ create function `createPlaylist`

➡️ take `title` and `musics` from `req.body`
➡️ inside try block:
   - create playlist using `playlistModel.create`
   - set:
       → `artist`: `req.user.fullName.firstName + " " + req.user.fullName.lastName`
       → `artistId`: `req.user.id`
       → `title`
       → `userId`
       → `musics`

➡️ send response after successful creation
```

```markdown
### ▶ Playlist Route (Artist)
➡️ go to `music.routes.js`
➡️ create POST `/playlist`
➡️ use `authArtistMiddleware`
➡️ call `createPlaylist` controller
```

```markdown
### ▶ Fetch Playlists (Artist)
➡️ in `music.controller.js`
➡️ create function `getPlaylists`

➡️ inside try block:
   - `const fetchedPlaylists = await playlistModel.find({ artistId: req.user.id })`
➡️ send response with fetched playlists
```

```markdown
### ▶ Playlist Route (User)
➡️ in `music.routes.js`
➡️ create GET `/playlist`
➡️ use `authUserMiddleware`
➡️ call `getPlaylists` controller
```

```markdown
### ▶ User Auth Middleware
➡️ go to `music.middleware.js`
➡️ create `authUserMiddleware`

➡️ extract token from request (cookies or headers)
➡️ if token missing → return 401 Unauthorized

➡️ in try block:
   - verify token using jwt
   - if valid, set `req.user = decoded`
   - call `next()`
```

```markdown
### ▶ Public Music List Protection
➡️ ensure `/` GET route uses:
   - `authUserMiddleware`
   - `getAllMusics` controller
```

```markdown
### ▶ Get All Musics Controller
➡️ in `music.controller.js`
➡️ create function `getAllMusics`

➡️ set pagination:
   - `skip` default or from `req.query`
   - `limit` default or from `req.query`

➡️ inside try block:
   - `musicDocs = await musicModel.find().skip(skip).limit(limit).lean()`
     // lean() improves performance by returning plain JS objects

➡️ create empty `musics` array
➡️ loop over `musicDocs` and push each item
➡️ send response with message and `musics` array
```

```markdown
### ▶ Playlist By ID Route
➡️ in `music.routes.js`
➡️ create GET `/playlist/:id`
➡️ use `authUserMiddleware`
➡️ call `getPlaylistById`
```

```markdown
### ▶ Get Playlist By ID Controller
➡️ in `music.controller.js`
➡️ create `getPlaylistById(req,res)`

➡️ extract `id` from `req.params`
➡️ inside try block:
   - `playlistDoc = await playlistModel.findById(id).lean()`

➡️ if playlistDoc not found → return 404

➡️ create empty `musics` array
➡️ loop:
   for (let musicId of playlistDoc.musics)
     - fetch music using `musicModel.findById(musicId).lean()`
     - if music exists:
         → `music.musicUrl = await getPresignedUrl(music.musicKey)`
         → `music.coverImageUrl = await getPresignedUrl(music.coverImageKey)`
         → push music to array

➡️ set `playlistDoc.musics = musics`
➡️ send playlistDoc in response
```

```markdown
### ▶ Get Specific Music Route
➡️ in `music.routes.js`
➡️ create GET `/get-details/:id`
➡️ use `authUserMiddleware`
➡️ call `getMusicById`
```

```markdown
### ▶ Get Music By ID Controller
➡️ in `music.controller.js`
➡️ create function `getMusicById`

➡️ extract `id` from `req.params`
➡️ inside try block:
   - `music = await musicModel.findById(id).lean()`

➡️ if music not found → return “music not found”
➡️ else:
   - `music.musicUrl = await getPresignedUrl(music.musicKey)`
   - `music.coverImageUrl = await getPresignedUrl(music.coverImageKey)`

➡️ return `{ music }` with status 200
```
