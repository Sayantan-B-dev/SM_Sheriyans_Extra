{
  "src\\app.js": "const express = require(\"express\");\r\nconst { connect, subscribeToQueue } = require(\"./borker/borker\");\r\nconst setListeners = require(\"./borker/listners\");\r\nconst app = express();\r\n\r\nconnect().then(() => {\r\n    setListeners();\r\n})\r\n\r\napp.get(\"/\", (req, res) => {\r\n    res.status(200).json({\r\n        message: \"Notification service is running\"\r\n    });\r\n})\r\n\r\n\r\n\r\nmodule.exports = app;",
  "src\\borker\\borker.js": "const amqplib = require('amqplib');\r\n\r\n\r\n\r\nlet channel, connection;\r\n\r\n\r\nasync function connect() {\r\n\r\n    if (connection) return connection;\r\n\r\n    try {\r\n        connection = await amqplib.connect(process.env.RABBIT_URL);\r\n        console.log('Connected to RabbitMQ');\r\n        channel = await connection.createChannel();\r\n    }\r\n    catch (error) {\r\n        console.error('Error connecting to RabbitMQ:', error);\r\n    }\r\n\r\n}\r\n\r\n\r\nasync function publishToQueue(queueName, data = {}) {\r\n    if (!channel || !connection) await connect();\r\n\r\n    await channel.assertQueue(queueName, {\r\n        durable: true\r\n    });\r\n\r\n    channel.sendToQueue(queueName, Buffer.from(JSON.stringify(data)));\r\n    console.log('Message sent to queue:', queueName, data);\r\n}\r\n\r\n\r\nasync function subscribeToQueue(queueName, callback) {\r\n\r\n    if (!channel || !connection) await connect();\r\n\r\n    await channel.assertQueue(queueName, {\r\n        durable: true\r\n    });\r\n\r\n    channel.consume(queueName, async (msg) => {\r\n        if (msg !== null) {\r\n            const data = JSON.parse(msg.content.toString());\r\n            await callback(data);\r\n            channel.ack(msg);\r\n        }\r\n    })\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = {\r\n    connect,\r\n    channel,\r\n    connection,\r\n    publishToQueue,\r\n    subscribeToQueue\r\n}\r\n",
  "src\\borker\\listners.js": "const { subscribeToQueue } = require(\"./borker\");\r\nconst { sendEmail } = require(\"../email\");\r\n\r\n\r\nmodule.exports = function () {\r\n\r\n    subscribeToQueue(\"AUTH_NOTIFICATION.USER_CREATED\", async (data) => {\r\n\r\n        const emailHTMLTemplate = `\r\n        <h1>Welcome to Our Service!</h1>\r\n        <p>Dear ${data.fullName.firstName + \" \" + (data.fullName.lastName || \"\")},</p>\r\n        <p>Thank you for registering with us. We're excited to have you on board!</p>\r\n        <p>Best regards,<br/>The Team</p>\r\n        `;\r\n\r\n        await sendEmail(data.email, \"Welcome to Our Service\", \"Thank you for registering with us!\", emailHTMLTemplate);\r\n\r\n    })\r\n\r\n    subscribeToQueue(\"PAYMENT_NOTIFICATION.PAYMENT_INITIATED\", async (data) => {\r\n        const emailHTMLTemplate = `\r\n        <h1>Payment Initiated</h1>\r\n        <p>Dear ${data.username},</p>\r\n        <p>Your payment of ${data.currency} ${data.amount} for the order ID: ${data.orderId} has been initiated.</p>\r\n        <p>We will notify you once the payment is completed.</p>\r\n        <p>Best regards,<br/>The Team</p>\r\n        `;\r\n        await sendEmail(data.email, \"Payment Initiated\", \"Your payment is being processed\", emailHTMLTemplate);\r\n    }\r\n)\r\n\r\n    subscribeToQueue(\"PAYMENT_NOTIFICATION.PAYMENT_COMPLETED\", async (data) => {\r\n        const emailHTMLTemplate = `\r\n        <h1>Payment Successful!</h1>\r\n        <p>Dear ${data.username},</p>\r\n        <p>We have received your payment of ${data.currency} ${data.amount} for the order ID: ${data.orderId}.</p>\r\n        <p>Thank you for your purchase!</p>\r\n        <p>Best regards,<br/>The Team</p>\r\n        `;\r\n        await sendEmail(data.email, \"Payment Successful\", \"We have received your payment\", emailHTMLTemplate);\r\n    })\r\n\r\n\r\n    subscribeToQueue(\"PAYMENT_NOTIFICATION.PAYMENT_FAILED\", async (data) => {\r\n        const emailHTMLTemplate = `\r\n        <h1>Payment Failed</h1>\r\n        <p>Dear ${data.username},</p>\r\n        <p>Unfortunately, your payment for the order ID: ${data.orderId} has failed.</p>\r\n        <p>Please try again or contact support if the issue persists.</p>\r\n        <p>Best regards,<br/>The Team</p>\r\n        `;\r\n        await sendEmail(data.email, \"Payment Failed\", \"Your payment could not be processed\", emailHTMLTemplate);\r\n    })\r\n\r\n    subscribeToQueue(\"PRODUCT_NOTIFICATION.PRODUCT_CREATED\", async (data) => {\r\n        const emailHTMLTemplate = `\r\n        <h1>New Product Available!</h1>\r\n        <p>Dear ${data.username},</p>\r\n        <p>Check it out and enjoy exclusive launch offers!</p>\r\n        <p>Best regards,<br/>The Team</p>\r\n        `;\r\n        await sendEmail(data.email, \"New Product Launched\", \"Check out our latest product\", emailHTMLTemplate);\r\n    })\r\n\r\n}",
  "src\\email.js": "const nodemailer = require('nodemailer');\r\n\r\nconst transporter = nodemailer.createTransport({\r\n    service: 'gmail',\r\n    auth: {\r\n        type: 'OAuth2',\r\n        user: process.env.EMAIL_USER,\r\n        clientId: process.env.CLIENT_ID,\r\n        clientSecret: process.env.CLIENT_SECRET,\r\n        refreshToken: process.env.REFRESH_TOKEN,\r\n    },\r\n});\r\n\r\n// Verify the connection configuration\r\ntransporter.verify((error, success) => {\r\n    if (error) {\r\n        console.error('Error connecting to email server:', error);\r\n    } else {\r\n        console.log('Email server is ready to send messages');\r\n    }\r\n});\r\n\r\n// Function to send email\r\nconst sendEmail = async (to, subject, text, html) => {\r\n    try {\r\n        const info = await transporter.sendMail({\r\n            from: `\"Your Name\" <${process.env.EMAIL_USER}>`, // sender address\r\n            to, // list of receivers\r\n            subject, // Subject line\r\n            text, // plain text body\r\n            html, // html body\r\n        });\r\n\r\n        console.log('Message sent: %s', info.messageId);\r\n        console.log('Preview URL: %s', nodemailer.getTestMessageUrl(info));\r\n    } catch (error) {\r\n        console.error('Error sending email:', error);\r\n    }\r\n};\r\n\r\n\r\nmodule.exports = { sendEmail };"
}