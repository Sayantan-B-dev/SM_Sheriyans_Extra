# E-Commerce Microservices Platform

## ğŸ“‹ Project Overview

This is a modern e-commerce platform built with a microservices architecture. The system consists of 8 independent services that communicate via HTTP and RabbitMQ message broker. Each service has its own database and can be developed, tested, and deployed independently.

### Architecture Diagram
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Gateway / Load Balancer              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Auth   â”‚ â”‚ Product   â”‚ â”‚ Cart  â”‚ â”‚ Order    â”‚ â”‚ Payment   â”‚
â”‚ (3000) â”‚ â”‚ (3001)    â”‚ â”‚ (3002)â”‚ â”‚ (3003)   â”‚ â”‚ (3004)    â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚            â”‚          â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚            â”‚          â”‚
            â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚AI Buddyâ”‚ â”‚Notificationâ”‚ â”‚Seller Dash â”‚
            â”‚(3005)  â”‚ â”‚ (3006)    â”‚ â”‚ (3007)     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Prerequisites

- **Node.js 18+**
- **MongoDB** (or MongoDB Atlas)
- **Redis** (for Auth service)
- **RabbitMQ** (message broker)
- **Docker & Docker Compose** (optional, for containerization)
- **Razorpay Account** (for payment service)
- **ImageKit Account** (for product image uploads)
- **Google Gemini API Key** (for AI Buddy)

## ğŸ“ Service Details & Environment Variables

### 1. **Auth Service** (Port: 3000)
**Purpose**: User authentication, registration, and profile management

**Environment Variables** (`.env`):
```env
PORT=3000
MONGO_URI=mongodb://localhost:27017/auth
JWT_SECRET=your-super-secret-jwt-key-here
JWT_COOKIE_NAME=token
RABBIT_URL=amqp://guest:guest@localhost:5672
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=  # if required
```

### 2. **Product Service** (Port: 3001)
**Purpose**: Product catalog management, CRUD operations, image uploads

**Environment Variables**:
```env
PORT=3001
MONGO_URI=mongodb://localhost:27017/products
JWT_SECRET=your-super-secret-jwt-key-here
RABBIT_URL=amqp://guest:guest@localhost:5672
IMAGEKIT_PUBLIC_KEY=your_imagekit_public_key
IMAGEKIT_PRIVATE_KEY=your_imagekit_private_key
IMAGEKIT_URL_ENDPOINT=https://ik.imagekit.io/your_endpoint
```

### 3. **Cart Service** (Port: 3002)
**Purpose**: Shopping cart management

**Environment Variables**:
```env
PORT=3002
MONGO_URI=mongodb://localhost:27017/cart
JWT_SECRET=your-super-secret-jwt-key-here
```

### 4. **Order Service** (Port: 3003)
**Purpose**: Order processing and management

**Environment Variables**:
```env
PORT=3003
MONGO_URI=mongodb://localhost:27017/orders
JWT_SECRET=your-super-secret-jwt-key-here
RABBIT_URL=amqp://guest:guest@localhost:5672
```

### 5. **Payment Service** (Port: 3004)
**Purpose**: Payment processing via Razorpay

**Environment Variables**:
```env
PORT=3004
MONGO_URI=mongodb://localhost:27017/payments
JWT_SECRET=your-super-secret-jwt-key-here
RABBIT_URL=amqp://guest:guest@localhost:5672
RAZORPAY_KEY_ID=your_razorpay_key_id
RAZORPAY_KEY_SECRET=your_razorpay_key_secret
```

### 6. **AI Buddy Service** (Port: 3005)
**Purpose**: AI-powered shopping assistant with websockets

**Environment Variables**:
```env
PORT=3005
JWT_SECRET=your-super-secret-jwt-key-here
GOOGLE_API_KEY=your_google_gemini_api_key
RABBIT_URL=amqp://guest:guest@localhost:5672
```

### 7. **Notification Service** (Port: 3006)
**Purpose**: Email notifications via RabbitMQ events

**Environment Variables**:
```env
PORT=3006
RABBIT_URL=amqp://guest:guest@localhost:5672
EMAIL_USER=your_email@gmail.com
CLIENT_ID=your_oauth2_client_id
CLIENT_SECRET=your_oauth2_client_secret
REFRESH_TOKEN=your_oauth2_refresh_token
```

### 8. **Seller Dashboard Service** (Port: 3007)
**Purpose**: Seller analytics and dashboard

**Environment Variables**:
```env
PORT=3007
MONGO_URI=mongodb://localhost:27017/seller_dashboard
JWT_SECRET=your-super-secret-jwt-key-here
RABBIT_URL=amqp://guest:guest@localhost:5672
```

## ğŸ³ Docker Setup

### Using Docker Compose (Recommended)

Create a `docker-compose.yml` in the root directory:

```yaml
version: '3.8'

services:
  mongodb:
    image: mongo:6
    ports:
      - "27017:27017"
    volumes:
      - mongodb_data:/data/db

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    command: redis-server --requirepass ${REDIS_PASSWORD:-redispass}

  rabbitmq:
    image: rabbitmq:3-management
    ports:
      - "5672:5672"
      - "15672:15672"
    environment:
      RABBITMQ_DEFAULT_USER: guest
      RABBITMQ_DEFAULT_PASS: guest

  auth:
    build: ./auth
    ports:
      - "3000:3000"
    environment:
      - MONGO_URI=mongodb://mongodb:27017/auth
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - REDIS_PASSWORD=${REDIS_PASSWORD:-redispass}
      - RABBIT_URL=amqp://guest:guest@rabbitmq:5672
    depends_on:
      - mongodb
      - redis
      - rabbitmq

  product:
    build: ./product
    ports:
      - "3001:3001"
    environment:
      - MONGO_URI=mongodb://mongodb:27017/products
      - RABBIT_URL=amqp://guest:guest@rabbitmq:5672
    depends_on:
      - mongodb
      - rabbitmq

  # Add similar configurations for other services...
  # (cart, order, payment, ai-buddy, notification, seller-dashboard)

volumes:
  mongodb_data:
```

### Building Individual Services

Each service has its own Dockerfile. Build example:
```bash
cd auth
docker build -t ecommerce-auth .
docker run -p 3000:3000 --env-file .env ecommerce-auth
```

## ğŸ› ï¸ Manual Setup (Without Docker)

### Step 1: Install Dependencies

```bash
# Clone the repository
git clone <repository-url>
cd ecommerce-microservices

# Install dependencies for each service
for service in auth product cart order payment ai-buddy notification seller-dashboard; do
  cd $service
  npm install
  cd ..
done
```

### Step 2: Start External Services

```bash
# Start MongoDB
mongod

# Start Redis
redis-server

# Start RabbitMQ (using Docker if not installed)
docker run -d --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management
```

### Step 3: Configure Environment Variables

Create `.env` files in each service directory with the variables listed above.

### Step 4: Run Services

In separate terminals:

```bash
# Terminal 1 - Auth Service
cd auth
npm run dev

# Terminal 2 - Product Service
cd product
npm run dev

# Terminal 3 - Cart Service
cd cart
npm run dev

# Terminal 4 - Order Service
cd order
npm run dev

# Terminal 5 - Payment Service
cd payment
npm run dev

# Terminal 6 - AI Buddy Service
cd ai-buddy
npm run dev

# Terminal 7 - Notification Service
cd notification
npm run dev

# Terminal 8 - Seller Dashboard
cd seller-dashboard
npm run dev
```

## ğŸ”§ API Endpoints

### Auth Service (http://localhost:3000)
- `POST /api/auth/register` - User registration
- `POST /api/auth/login` - User login
- `GET /api/auth/me` - Get current user
- `GET /api/auth/logout` - Logout
- `GET /api/auth/users/me/addresses` - Get user addresses
- `POST /api/auth/users/me/addresses` - Add address
- `DELETE /api/auth/users/me/addresses/:addressId` - Delete address

### Product Service (http://localhost:3001)
- `POST /api/products` - Create product (seller/admin)
- `GET /api/products` - List products (with search, filter, pagination)
- `GET /api/products/:id` - Get product by ID
- `PATCH /api/products/:id` - Update product (seller)
- `DELETE /api/products/:id` - Delete product (seller)
- `GET /api/products/seller` - Get seller's products

### Cart Service (http://localhost:3002)
- `GET /api/cart` - Get cart
- `POST /api/cart/items` - Add item to cart
- `PATCH /api/cart/items/:productId` - Update item quantity

### Order Service (http://localhost:3003)
- `POST /api/orders` - Create order
- `GET /api/orders/me` - Get user's orders
- `GET /api/orders/:id` - Get order by ID
- `POST /api/orders/:id/cancel` - Cancel order
- `PATCH /api/orders/:id/address` - Update order address

### Payment Service (http://localhost:3004)
- `POST /api/payments/create/:orderId` - Create payment
- `POST /api/payments/verify` - Verify payment

### AI Buddy Service (http://localhost:3005)
- WebSocket endpoint for AI chat assistant
- Tools: Search products, add to cart

### Seller Dashboard (http://localhost:3007)
- `GET /api/seller/dashboard/metrics` - Get seller metrics
- `GET /api/seller/dashboard/orders` - Get seller orders
- `GET /api/seller/dashboard/products` - Get seller products

## ğŸ§ª Testing

Each service has its own test setup:

### Auth Service Tests
```bash
cd auth
npm test
```

### Product Service Tests
```bash
cd product
npm test
```

### Cart Service Tests
```bash
cd cart
npm test
```

### Order Service Tests
```bash
cd order
npm test
```

## ğŸ“Š Database Schemas

### User Schema (Auth Service)
```javascript
{
  username: String,
  email: String,
  password: String,
  fullName: { firstName: String, lastName: String },
  role: ['user', 'seller'],
  addresses: [{
    street: String,
    city: String,
    state: String,
    zip: String,
    country: String,
    isDefault: Boolean
  }]
}
```

### Product Schema (Product Service)
```javascript
{
  title: String,
  description: String,
  price: { amount: Number, currency: String },
  seller: ObjectId,
  images: [{ url: String, thumbnail: String, id: String }],
  stock: Number
}
```

### Cart Schema (Cart Service)
```javascript
{
  user: ObjectId,
  items: [{
    productId: ObjectId,
    quantity: Number
  }]
}
```

### Order Schema (Order Service)
```javascript
{
  user: ObjectId,
  items: [{
    product: ObjectId,
    quantity: Number,
    price: { amount: Number, currency: String }
  }],
  status: ['PENDING', 'CONFIRMED', 'CANCELLED', 'SHIPPED', 'DELIVERED'],
  totalPrice: { amount: Number, currency: String },
  shippingAddress: {
    street: String,
    city: String,
    state: String,
    zip: String,
    country: String
  }
}
```

## ğŸ”„ Message Queues (RabbitMQ)

The system uses RabbitMQ for asynchronous communication between services:

### Queues and Events:

1. **User Events** (Auth â†’ Notification, Seller Dashboard)
   - `AUTH_NOTIFICATION.USER_CREATED`
   - `AUTH_SELLER_DASHBOARD.USER_CREATED`

2. **Product Events** (Product â†’ Seller Dashboard, Notification)
   - `PRODUCT_SELLER_DASHBOARD.PRODUCT_CREATED`
   - `PRODUCT_NOTIFICATION.PRODUCT_CREATED`

3. **Order Events** (Order â†’ Seller Dashboard)
   - `ORDER_SELLER_DASHBOARD.ORDER_CREATED`

4. **Payment Events** (Payment â†’ Seller Dashboard, Notification)
   - `PAYMENT_SELLER_DASHBOARD.PAYMENT_CREATED`
   - `PAYMENT_SELLER_DASHBOARD.PAYMENT_UPDATED`
   - `PAYMENT_NOTIFICATION.PAYMENT_INITIATED`
   - `PAYMENT_NOTIFICATION.PAYMENT_COMPLETED`
   - `PAYMENT_NOTIFICATION.PAYMENT_FAILED`

## ğŸ” Authentication & Authorization

- **JWT-based authentication** with cookies
- **Role-based access control**: `user`, `seller`, `admin`
- **Token blacklisting** via Redis for logout functionality
- **Middleware pattern** for protecting routes

## ğŸ“¦ Dependencies

Common dependencies across services:
- `express` - Web framework
- `mongoose` - MongoDB ODM
- `jsonwebtoken` - JWT handling
- `amqplib` - RabbitMQ client
- `cookie-parser` - Cookie handling

Service-specific dependencies:
- `bcryptjs` - Password hashing (Auth)
- `razorpay` - Payment processing (Payment)
- `imagekit` - Image uploads (Product)
- `@langchain/google-genai` - AI capabilities (AI Buddy)
- `nodemailer` - Email sending (Notification)
- `socket.io` - WebSockets (AI Buddy)

## ğŸš¨ Error Handling

- **Centralized error handling** in each service
- **Validation middleware** using express-validator
- **HTTP status codes** for different scenarios
- **Error logging** to console (can be extended to logging service)

## ğŸ“ˆ Monitoring & Logging

### Suggested Improvements:
1. **Centralized logging** with Winston
2. **Distributed tracing** with Jaeger
3. **Health check endpoints** for each service
4. **Metrics collection** with Prometheus
5. **API documentation** with Swagger/OpenAPI

## ğŸ”„ CI/CD Setup

### GitHub Actions Example (`.github/workflows/ci.yml`):
```yaml
name: CI/CD Pipeline

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        service: [auth, product, cart, order, payment]
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'
      - name: Install dependencies
        run: |
          cd ${{ matrix.service }}
          npm ci
      - name: Run tests
        run: |
          cd ${{ matrix.service }}
          npm test
        env:
          JWT_SECRET: test-secret
          MONGO_URI: mongodb://localhost:27017/test
```

## ğŸ› Troubleshooting

### Common Issues:

1. **Port conflicts**: Ensure ports 3000-3007 are free
2. **MongoDB connection**: Check `MONGO_URI` format and MongoDB status
3. **RabbitMQ connection**: Verify RabbitMQ is running on port 5672
4. **JWT issues**: Ensure same `JWT_SECRET` across all services
5. **CORS issues**: Add CORS middleware if accessing from different domains

### Debug Commands:
```bash
# Check MongoDB
mongosh --eval "db.adminCommand('ping')"

# Check Redis
redis-cli ping

# Check RabbitMQ
curl -u guest:guest http://localhost:15672/api/healthchecks/node

# Check service health
curl http://localhost:3000/
```

## ğŸ“š Additional Documentation

- [MongoDB Documentation](https://docs.mongodb.com/)
- [RabbitMQ Tutorials](https://www.rabbitmq.com/getstarted.html)
- [JWT Best Practices](https://jwt.io/introduction)
- [Docker Documentation](https://docs.docker.com/)
